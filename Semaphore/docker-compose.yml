

services:
  semaphore:
    image: semaphoreui/semaphore:latest
    container_name: semaphore-ui
    ports:
      - "3000:3000"
    environment:
      - SEMAPHORE_DB_DIALECT=postgres
      - SEMAPHORE_DB_HOST=db
      - SEMAPHORE_DB_PORT=5432
      - SEMAPHORE_DB_USER=semaphore
      - SEMAPHORE_DB_PASS=          # ← CHANGE THIS
      - SEMAPHORE_DB=semaphore
      - SEMAPHORE_ADMIN=admin
      - SEMAPHORE_ADMIN_PASSWORD=     # ← CHANGE THIS
      - SEMAPHORE_ADMIN_NAME=Admin
      - SEMAPHORE_ADMIN_EMAIL=admin@example.com
      - SEMAPHORE_ACCESS_KEY_ENCRYPTION= #64char_hex_key
    volumes:
      - semaphore-config:/etc/semaphore
      - semaphore-data:/var/lib/semaphore
    depends_on:
      - db
    restart: unless-stopped

  db:
    image: postgres:15
    container_name: semaphore-postgres
    environment:
      - POSTGRES_DB=semaphore
      - POSTGRES_USER=semaphore
      - POSTGRES_PASSWORD=       # ← MUST MATCH ABOVE
    volumes:
      - pgdata:/var/lib/postgresql/data
    restart: unless-stopped

volumes:
  semaphore-config:
  semaphore-data:
  pgdata:
